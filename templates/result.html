<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Analysis Results</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
  <script>
    window.__JOB_ID__ = "{{ job_id }}";
  </script>
</head>
<body class="bg-light">
  <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom mb-4">
    <div class="container">
      <a class="navbar-brand fw-bold" href="/">üéØ Lip-Sync-Based Deepfake Detection</a>
      <a href="/" class="btn btn-sm btn-outline-secondary">‚Üê New Analysis</a>
    </div>
  </nav>

  <div class="container pb-5">
    <!-- Loading Panel -->
    <div id="loadingPanel" class="alert alert-info border-0 shadow-lg">
      <div class="d-flex align-items-center">
        <div class="spinner-border text-primary me-3" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <div class="flex-grow-1">
          <h5 class="mb-1">üîÑ Processing Video...</h5>
          <div class="progress mt-2" style="height: 8px; border-radius: 4px;">
            <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                 style="width: 0%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));"></div>
          </div>
          <div class="small mt-2">
            <span id="progressText" class="fw-bold">0%</span> ‚Ä¢ 
            <span id="statusMessage" class="text-muted">Initializing...</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Panels -->
    <div id="resultPanels" class="d-none">
      <!-- Summary Banner -->
      <div class="card mb-4 border-0 shadow-lg fade-in">
        <div class="card-body p-4">
          <div class="row align-items-center">
            <div class="col-md-8">
              <div id="summaryCard" class="p-4 rounded-3 border">
                <div id="finalVerdict" class="mb-3">‚Äî</div>
                <div class="row g-3">
                  <div class="col-md-3">
                    <div class="text-muted small mb-1">Avg Confidence</div>
                    <div class="h5 mb-0"><span id="avgConf">‚Äî</span></div>
                  </div>
                  <div class="col-md-3">
                    <div class="text-muted small mb-1">Total Frames</div>
                    <div class="h5 mb-0"><span id="totalFrames">‚Äî</span></div>
                  </div>
                  <div class="col-md-3">
                    <div class="text-muted small mb-1">Processing Time</div>
                    <div class="h5 mb-0"><span id="procTime">‚Äî</span>s</div>
                  </div>
                  <div class="col-md-3">
                    <a id="downloadCsv" href="#" class="btn btn-outline-secondary w-100">
                      üì• Download CSV
                    </a>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-4 text-center">
              <div class="display-1" id="verdictIcon">üîç</div>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-4">
        <!-- Video Section -->
        <div class="col-lg-8">
          <div class="card h-100 shadow-sm fade-in">
            <div class="card-body">
              <h5 class="card-title">üìπ Video Analysis</h5>
              <video id="videoPlayer" class="w-100 rounded mb-3" controls></video>
              <div>
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <span class="small fw-semibold text-muted">TIMELINE</span>
                  <div class="small">
                    <span class="badge" style="background: var(--success-color);">REAL</span>
                    <span class="badge" style="background: var(--danger-color);">FAKE</span>
                  </div>
                </div>
                <canvas id="timelineCanvas" height="28" class="w-100 rounded border"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Chunk Table -->
        <div class="col-lg-4">
          <div class="card h-100 shadow-sm fade-in">
            <div class="card-body">
              <h5 class="card-title">üìä Chunk Analysis</h5>
              <div class="table-responsive" style="max-height: 440px; overflow:auto;">
                <table class="table table-sm table-hover align-middle mb-0" id="chunkTable">
                  <thead class="sticky-top">
                    <tr>
                      <th>#</th><th>Time</th><th>Conf</th><th>Label</th><th>Frame</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Confidence Chart -->
        <div class="col-lg-8">
          <div class="card shadow-sm fade-in">
            <div class="card-body">
              <h5 class="card-title">üìà Confidence Over Time</h5>
              <canvas id="confidenceChart" height="100"></canvas>
            </div>
          </div>
        </div>

        <!-- Frames Carousel -->
        <div class="col-lg-4">
          <div class="card shadow-sm fade-in">
            <div class="card-body">
              <h5 class="card-title">üñºÔ∏è Extracted Frames</h5>
              <div id="framesCarousel" class="row g-2" style="max-height: 320px; overflow-y: auto;"></div>
            </div>
          </div>
        </div>

        <!-- Audio Waveform -->
        <div class="col-12">
          <div class="card shadow-sm fade-in">
            <div class="card-body">
              <h5 class="card-title">üéµ Audio Waveform Analysis</h5>
              <div id="audioWave" style="height:200px; border-radius: 8px;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>